<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Churn Prediction Platform</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .section h2 {
            color: #34495e;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        input[type="file"], input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .sample-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .sample-data h4 {
            margin-top: 0;
            color: #495057;
        }
        .sample-data pre {
            background: white;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Customer Churn Prediction Platform</h1>
        
        <!-- Upload Section -->
        <div class="section">
            <h2>1. Upload Dataset</h2>
            <div class="form-group">
                <label for="csvFile">Select CSV File:</label>
                <input type="file" id="csvFile" accept=".csv">
            </div>
            <div class="form-group">
                <label for="targetColumn">Target Column (e.g., 'Churn'):</label>
                <input type="text" id="targetColumn" placeholder="Enter target column name">
            </div>
            <button onclick="uploadDataset()">Upload Dataset</button>
            <div id="uploadResult"></div>
        </div>

        <!-- Analysis Section -->
        <div class="section">
            <h2>2. Dataset Analysis</h2>
            <button onclick="analyzeDataset()">Analyze Dataset</button>
            <button onclick="previewDataset()">Preview Dataset</button>
            <div id="analysisResult"></div>
        </div>

        <!-- Training Section -->
        <div class="section">
            <h2>3. Train Model</h2>
            <div class="form-group">
                <label for="modelType">Model Type:</label>
                <select id="modelType">
                    <option value="random_forest">Random Forest</option>
                    <option value="logistic_regression">Logistic Regression</option>
                </select>
            </div>
            <button onclick="trainModel()">Train Model</button>
            <div id="trainingResult"></div>
        </div>

        <!-- Prediction Section -->
        <div class="section">
            <h2>4. Make Predictions</h2>
            <div class="sample-data">
                <h4>Sample Customer Data (JSON format):</h4>
                <pre id="sampleData">[
  {
    "customer_id": "C001",
    "tenure": 12,
    "monthly_charges": 29.85,
    "total_charges": 358.2,
    "contract": "Month-to-month",
    "payment_method": "Electronic check"
  }
]</pre>
            </div>
            <div class="form-group">
                <label for="predictionData">Customer Data (JSON):</label>
                <textarea id="predictionData" rows="6" style="width: 100%; font-family: monospace;" placeholder="Enter customer data in JSON format"></textarea>
            </div>
            <button onclick="makePrediction()">Make Prediction</button>
            <button onclick="explainPrediction()">Predict with Explanation</button>
            <div id="predictionResult"></div>
        </div>

        <!-- Model Info Section -->
        <div class="section">
            <h2>5. Model Information</h2>
            <button onclick="getModelInfo()">Get Model Info</button>
            <div id="modelInfoResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result">${JSON.stringify(data, null, 2)}</div>`;
        }

        async function uploadDataset() {
            const fileInput = document.getElementById('csvFile');
            const targetColumn = document.getElementById('targetColumn').value;
            
            if (!fileInput.files[0]) {
                showStatus('uploadResult', 'Please select a CSV file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            if (targetColumn) {
                formData.append('target_column_name', targetColumn);
            }

            try {
                showStatus('uploadResult', 'Uploading dataset...', 'info');
                
                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    showStatus('uploadResult', 'Dataset uploaded successfully!', 'success');
                    showResult('uploadResult', result);
                } else {
                    showStatus('uploadResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('uploadResult', `Error: ${error.message}`, 'error');
            }
        }

        async function analyzeDataset() {
            try {
                showStatus('analysisResult', 'Analyzing dataset...', 'info');
                
                const response = await fetch(`${API_BASE}/analyze`);
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('analysisResult', 'Analysis completed!', 'success');
                    showResult('analysisResult', result);
                } else {
                    showStatus('analysisResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('analysisResult', `Error: ${error.message}`, 'error');
            }
        }

        async function previewDataset() {
            try {
                showStatus('analysisResult', 'Loading dataset preview...', 'info');
                
                const response = await fetch(`${API_BASE}/preview?rows=10`);
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('analysisResult', 'Preview loaded!', 'success');
                    showResult('analysisResult', result);
                } else {
                    showStatus('analysisResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('analysisResult', `Error: ${error.message}`, 'error');
            }
        }

        async function trainModel() {
            const modelType = document.getElementById('modelType').value;
            
            try {
                showStatus('trainingResult', 'Training model...', 'info');
                
                // const response = await fetch(`${API_BASE}/train?model_type=${modelType}`, {
                //     method: 'POST'
                // });
                 // Send the list directly, not wrapped in an object
                const payload = { model_types: [modelType] };
                console.log('DEBUG: Sending payload:', JSON.stringify(payload)); // Debug log
                
                const response = await fetch(`${API_BASE}/train`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
        
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('trainingResult', 'Model trained successfully!', 'success');
                    showResult('trainingResult', result);
                } else {
                    showStatus('trainingResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('trainingResult', `Error: ${error.message}`, 'error');
            }
        }

        async function makePrediction() {
            const dataInput = document.getElementById('predictionData').value;
            
            if (!dataInput) {
                showStatus('predictionResult', 'Please enter customer data', 'error');
                return;
            }

            try {
                const data = JSON.parse(dataInput);
                showStatus('predictionResult', 'Making predictions...', 'info');
                
                const response = await fetch(`${API_BASE}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('predictionResult', 'Predictions completed!', 'success');
                    showResult('predictionResult', result);
                } else {
                    showStatus('predictionResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('predictionResult', `Error: ${error.message}`, 'error');
            }
        }

        async function explainPrediction() {
            const dataInput = document.getElementById('predictionData').value;
            
            if (!dataInput) {
                showStatus('predictionResult', 'Please enter customer data', 'error');
                return;
            }

            try {
                const data = JSON.parse(dataInput);
                showStatus('predictionResult', 'Generating predictions with explanations...', 'info');
                
                const response = await fetch(`${API_BASE}/explain`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('predictionResult', 'Predictions with explanations completed!', 'success');
                    showResult('predictionResult', result);
                } else {
                    showStatus('predictionResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('predictionResult', `Error: ${error.message}`, 'error');
            }
        }

        async function getModelInfo() {
            try {
                showStatus('modelInfoResult', 'Getting model information...', 'info');
                
                const response = await fetch(`${API_BASE}/model-info`);
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('modelInfoResult', 'Model information retrieved!', 'success');
                    showResult('modelInfoResult', result);
                } else {
                    showStatus('modelInfoResult', `Error: ${result.detail}`, 'error');
                }
            } catch (error) {
                showStatus('modelInfoResult', `Error: ${error.message}`, 'error');
            }
        }

        // Load sample data
        document.getElementById('predictionData').value = document.getElementById('sampleData').textContent;
    </script>
</body>
</html>